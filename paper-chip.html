<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-focusable/core-focusable.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-shadow/paper-shadow.html">

<!--
Material Design: [Chips](http://www.google.com/design/spec/components/chips.html)

`paper-chip` is a small element that represents a complex entity such as a
calendar event or a contact. The chip can be in an opened or closed state. In
its closed state, it contains an icon and a short title. In its open state, the
chip expands to show more detail about the represented entity, as well as
(optionally) a "remove" button that removes the chip element from the DOM.

The following child elements may be placed within the chip tag define its
content:

  * .icon: The icon representing the chip. This may be any element, for
            example, a `<core-icon>` or a simple `<span>` with a single letter
  * h1: The chip label, shown in both closed and opened states
  * h2: A secondary label, shown only in the opened state

The `removable` attribute can be used to add a button which removes the chip
from the DOM.

## Examples:

Removable chip with core-icon

    <paper-chip removable>
      <core-icon class="icon" icon="avatars:avatar-1"></core-icon>
      <h1>John Doe</h1>
      <h2>jdoe@example.com</h2>
    </paper-chip>

Basic chip with single letter instead of an icon

    <paper-chip label="Jane Doe">
      <div class="icon" flex>J</div>
      <h1>jdoe@example.com</h1>
    </paper-chip>


@element paper-chip
@blurb A basic "chip" element representing an icon/image and a short piece of text.
@status alpha
@homepage https://github.com/bendavis78/paper-chip
-->
<polymer-element name="paper-chip" tabindex="0">
  <template>
    <style>
      :host {
        display: inline-block;
        vertical-align: top;
        position: relative;
        outline: none;
        font-size: 14px;
        cursor: default;
        margin: 8px 0;
      }
      :host *,
      :host /deep/ *,
      :host ::content * {
        transition: 200ms ease-in;
      }
      #main {
        overflow: hidden;
        border-radius: 16px;
      }
      #main {
        background: #EBEBEB;
        position: relative;
        color: #989898;
      }
      #main #label ::content {
        color: #989898;
      }
      #chip {
        box-sizing: border-box;
        height: 32px;
      }
      paper-shadow {
        border-radius: 16px;
      }
      #icon {
        width: 32px;
        height: 32px;
        overflow: hidden;
        border-radius: 100%;
        text-align: center;
        font-size: 16px;
        font-weight: bold;
        background: #989898;
        color: #EBEBEB;
        line-height: 32px;
        margin-right: 8px;
      }
      #icon ::content * {
        font-size: 16px;
      }
      #icon ::content core-icon.icon,
      #icon ::content core-icon.icon svg {
        width: 32px;
        height: 32px;
      }
      #icon ::content core-icon.icon {
        vertical-align: bottom;
      }
      #label {
        padding-right: 12px;
      }
      #label ::content h1,
      #label ::content h2 {
        margin: 0;
        font-weight: normal;
        font-size: 14px;
        color: #989898;
      }
      #removeBtn {
        padding: 0;
      }
      #removeBtn /deep/ core-icon {
        padding: 0;
        margin: 0;
        width: 20px;
        height: 20px;
        margin-left: 20px;
        color: #00b8d4;
        background: #fff;
        border-radius: 100%;
      }
      /* initially hidden elements */
      :host(:not([opened])) #label ::content h2 {
        font-size: 0;
      }
      :host(:not([opened])) #removeBtn /deep/ core-icon {
        width: 0;
        height: 0;
        margin: 0;
      }
      :host([opened]) #main #label ::content h1,
      :host([opened]) #main #label ::content h2 {
        color: #fff;
      }
      :host([opened]) #main {
        border-radius: 0;
      }
      :host([opened]) #chip {
        padding: 16px 12px;
        background: #00B8D4;
        height: 72px;
      }
      :host([opened]) paper-shadow {
        border-radius: 0; 
      }
      :host([opened]) #icon ::content * {
        font-size: 20px;
      }
      :host([opened]) #icon,
      :host([opened]) #icon ::content core-icon.icon,
      :host([opened]) #icon ::content core-icon.icon svg {
        width: 40px;
        height: 40px;
      }
      :host([opened]) #label ::content h1 {
        font-size: 16px;
      }
    </style>
    <div id="main" layout vertical>
      <template if="{{focused || opened}}">
        <paper-shadow id="shadow" fit animated></paper-shadow>
      </template>
      <div id="chip" layout horizontal center>
        <div id="icon" layout horizontal center center-justified>
          <content select=".icon"></content>
        </div>
        <div id="label" flex self-center>
          <content select="h1"></content>
          <content select="h2"></content>
        </div>
        <template if="{{removable}}">
          <div self-center>
            <paper-icon-button id="removeBtn" icon="close" on-up="{{upAction}}" on-tap="{{remove}}"></paper-icon-button>
          </div>
        </template>
      </div>
      <template if="{{opened}}">
        <div flex id="content"><content></content></div>
      </template>
    </div>
  </template>

  <script>
    Polymer(Polymer.mixin2({
      publish: {
        /**
         * Whether or not the chip is removable. If true, a remove button will
         * be shown.
         * 
         * @attribute removable
         * @type boolean
         * @default false
         */
        removable: {
          value: false,
          reflect: true
        },

        /**
         * Whether or not the chip is in its opened state
         * 
         * @attribute opened
         * @type boolean
         * @default false
         */
        opened: {
          value: false,
          reflect: true
        }
      },
      eventDelegates: {
        down: 'downAction',
        up: 'upAction',
        blur: 'blurAction'
      },
      downAction: function() {
        this.pressed = true;
        this.focused = true;
      },
      upAction: function(e) {
        // TODO: better way to do this?
        if (e.target != this.$.removeBtn) {
          console.log('upAction ', e.target);
          this.pressed = false;
          this.toggleOpened();
        }
      },
      blurAction: function() {
        this.pressed = false;
        this.opened = false;
        this.focused = false;
      },
      /**
       * Fired before the element is removed. This event is cancelable.
       * 
       * @event remove
       */
      remove: function() {
        var e = this.fire('remove', {}, this, false, true);
        if (!e.defaultPrevented) {
          this.parentNode.removeChild(this);
        }
      },
      toggleOpened: function() {
        this.opened = !this.opened;
      },
    }, Polymer.CoreFocusable));
  </script>

</polymer-element>
